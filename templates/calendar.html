{% extends "layout.html" %}

{% block content %}

<div id="calendar"></div>


<script>
  document.addEventListener('DOMContentLoaded', function() {
    const calendarEl = document.getElementById('calendar')
    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth', // Chế độ xem mặc định
      headerToolbar: {
        left: 'prev,next today', // Các nút điều hướng
        center: 'title', // Tiêu đề
        right: 'dayGridMonth,timeGridWeek,timeGridDay' // Chuyển đổi chế độ xem
      },
      views: {
        dayGridMonth: { buttonText: 'Tháng' }, // Nút hiển thị là "Tháng"
        timeGridWeek: { buttonText: 'Tuần' }, // Nút hiển thị là "Tuần"
        timeGridDay: { buttonText: 'Ngày' } // Nút hiển thị là "Ngày"
      },
      events: 'api/booking/get_bookings', // API endpoint để lấy dữ liệu
        eventDataTransform: function(eventData) {
      // Chuyển đổi định dạng dữ liệu
      const [day, month, year] = eventData.reservation_date.split('/');
      let color;

      // Đặt màu sắc dựa trên phòng
      switch (eventData.room_name) {
        case 'Phòng họp nhỏ lầu 1':
          color = '#FF5733'; // Màu cam
          break;
        case 'Phòng họp dài lầu 1':
          color = '#33FF57'; // Màu xanh lá
          break;
        case 'Phòng họp lầu 2':
          color = '#e3f858'; // Màu xanh lá'
          break;
        case 'Phòng giải trí lầu 9':
          color = '#58e2f4'; // Màu xanh lá'
          break;
        default:
          color = '#3357FF'; // Màu xanh dương
  }
      return {
        id: eventData.booking_id,
        title: eventData.booking_name || "Không có tiêu đề",
        start: `${year}-${month}-${day}T${eventData.start_time}`,
        end: `${year}-${month}-${day}T${eventData.end_time}`,
        allDay: false, // Đánh dấu sự kiện không phải cả ngày
        backgroundColor: color, // Màu nền
        borderColor: color,     // Màu viền
        textColor: '#ffffff',   // Màu chữ
        extendedProps: {
          chairman: eventData.chairman,
          department: eventData.department,
          room_name: eventData.room_name,
          meeting_content: eventData.meeting_content,
          username: eventData.username,
          role: eventData.role
        }
      };
    },
    eventClick: function(info) {
      // Hiển thị chi tiết sự kiện khi người dùng nhấn vào
      const props = info.event.extendedProps;
      alert(`
        Tên sự kiện: ${info.event.title}
        Người chủ trì: ${props.chairman}
        Bộ phận: ${props.department}
        Phòng: ${props.room_name}
        Nội dung: ${props.meeting_content}
        Thời gian: ${info.event.start.toISOString()} - ${info.event.end.toISOString()}
      `);
    }
    });
    calendar.render()
  })
</script>

{% endblock %}